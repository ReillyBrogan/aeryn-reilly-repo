#
# SPDX-FileCopyrightText: Â© 2020-2024 Serpent OS Developers
#
# SPDX-License-Identifier: MPL-2.0
#
name        : tidal-hifi
version     : 6.2.0
release     : 2
summary     : tidal
license     : MIT
homepage    : https://github.com/Mastermindzh/tidal-hifi
upstreams   :
    - https://github.com/Mastermindzh/tidal-hifi/archive/refs/tags/6.2.0.tar.gz: 295a56705ed093a163e6c63fba89c572237601164e63d8df8d6704c4a6772958
description : |
    tidal
networking  : true
builddeps   :
    - binary(make)
    # - binary(nm)
    - binary(npm)
    - binary(python3)
rundeps     :
    - libnotify
setup       : |
    npm install
build       : |
    npm run build-unpacked
install     : |
    tidaldir=%(libdir)/%(name)

    %install_dir %(installroot)$tidaldir
    cp -a dist/linux-unpacked/* %(installroot)$tidaldir

    # Kill dep on musl
    rm -rfv %(installroot)$tidaldir/resources/app.asar.unpacked/node_modules/@parcel/watcher-linux-x64-musl/

    %install_dir %(installroot)%(bindir)
    ln -srv %(installroot)$tidaldir/tidal-hifi %(installroot)%(bindir)/tidal-hifi

    %install_file %(pkgdir)/*.desktop -t %(installroot)/usr/share/applications/

    for i in 16 32 64 128 256; do
        %install_dir %(installroot)/%(datadir)/icons/hicolor/${i}x${i}/apps
        %install_file assets/icons/${i}x${i}.png %(installroot)/%(datadir)/icons/hicolor/${i}x${i}/apps/tidal-hifi.png
    done
