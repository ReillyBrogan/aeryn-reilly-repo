#
# SPDX-FileCopyrightText: Â© 2020-2024 Serpent OS Developers
#
# SPDX-License-Identifier: MPL-2.0
#
name        : webcatalog-bin
version     : 73.8.0
release     : 3
summary     : webcatalog
license     : Distributable
homepage    : https://webcatalog.io/en/desktop
upstreams   :
    - https://cdn-2.webcatalog.io/webcatalog/WebCatalog-73.8.0.AppImage:
        hash: 6a1c02399013f0fe1ce3e4f0e7a3c2833c03190abc02aeead2e1c605ca2d0183
        unpack: false
        rename: WebCatalog
description : |
    webcatalog
builddeps   :
    - binary(mogrify)
    - binary(patch)
    - soname(libfuse.so.2(x86_64))
rundeps     :
    - soname(libfuse.so.2(x86_64))
# Causes krisp noise suppression not to load
debug       : false
strip       : false
setup       : |
    chmod +x %(sourcedir)/WebCatalog
    %(sourcedir)/WebCatalog --appimage-extract
install     : |
    %install_exe %(sourcedir)/WebCatalog %(installroot)%(libdir)/appimages/WebCatalog.appimage
    %install_dir %(installroot)%(bindir)
    ln -srv %(installroot)%(libdir)/appimages/WebCatalog.appimage %(installroot)%(bindir)/webcatalog

    %install_dir %(installroot)%(datadir)/applications
    cp -r --no-preserve=mode,ownership squashfs-root/usr/share/icons %(installroot)%(datadir)
    cp -r --no-preserve=mode,ownership squashfs-root/@webcatalogdesktop.desktop %(installroot)%(datadir)/applications/webcatalog.desktop
    patch -d "%(installroot)" -p1 < "%(pkgdir)/webcatalog.patch"
    rm %(installroot)%(datadir)/applications/webcatalog.desktop.orig

    # Most (all?) DM/WMs can't work with 1024x1024 icons
    %install_dir %(installroot)%(datadir)/icons/hicolor/512x512/apps
    cp %(installroot)%(datadir)/icons/hicolor/1024x1024/apps/@webcatalogdesktop.png %(installroot)%(datadir)/icons/hicolor/512x512/apps/@webcatalogdesktop.png
    mogrify -resize 512x512 %(installroot)%(datadir)/icons/hicolor/512x512/apps/@webcatalogdesktop.png
